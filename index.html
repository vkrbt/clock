<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NYC Clock</title>
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NYC Clock">
    <link rel="apple-touch-icon" href="clock.png">
    
    <!-- Android PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Mono:wght@400;700&family=Cormorant+Garamond:wght@400;500&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            font-family: 'Cormorant Garamond', Georgia, serif;
            /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ safe-area –¥–ª—è iPhone —Å –≤—ã—Ä–µ–∑–æ–º */
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .clock-container {
            position: relative;
            /* –£—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —á–∞—Å–æ–≤ (~60px) –∏ –æ—Ç—Å—Ç—É–ø—ã */
            width: min(90vw, calc(100vh - 120px), 600px);
            height: min(90vw, calc(100vh - 120px), 600px);
            filter: drop-shadow(0 20px 50px rgba(0, 0, 0, 0.5));
            overflow: hidden;
            flex-shrink: 0;
        }

        .clock-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .clock-layer img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .clock-face {
            z-index: 1;
        }

        .hour-hand {
            z-index: 2;
        }

        .minute-hand {
            z-index: 3;
        }

        .second-hand {
            z-index: 4;
        }

        .digital-clock {
            margin-top: clamp(10px, 2vh, 30px);
            font-family: 'Atkinson Hyperlegible Mono', monospace;
            font-weight: 500;
            font-size: clamp(1.4rem, 5vw, 2.8rem);
            color: #b8956c;
            text-shadow: 0 0 20px rgba(184, 149, 108, 0.5);
            letter-spacing: 0.08em;
            background: linear-gradient(180deg, #d4af6a 0%, #a08060 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-height: 100vh;
            max-width: 100vw;
            padding: 20px;
        }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .audio-blocked-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.75);
            color: rgba(212, 175, 106, 0.9);
            padding: 12px 24px;
            border-radius: 10px;
            border: 1px solid rgba(184, 149, 108, 0.2);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .audio-blocked-hint.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    <div class="wrapper">
    <div class="clock-container">
        <div class="clock-layer clock-face">
            <img src="clock.webp" alt="–¶–∏—Ñ–µ—Ä–±–ª–∞—Ç">
        </div>
        <div class="clock-layer hour-hand hand" id="hour">
            <img src="hour.webp" alt="–ß–∞—Å–æ–≤–∞—è —Å—Ç—Ä–µ–ª–∫–∞">
        </div>
        <div class="clock-layer minute-hand hand" id="minute">
            <img src="minute.webp" alt="–ú–∏–Ω—É—Ç–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞">
        </div>
        <div class="clock-layer second-hand hand" id="second">
            <img src="second.webp" alt="–°–µ–∫—É–Ω–¥–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞">
        </div>
    </div>
    <div class="digital-clock" id="digital">00:00:00</div>
    </div>
    <div class="audio-blocked-hint" id="audioHint">üîá –ó–≤—É–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ù–∞–∂–º–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</div>

    <script>
        const hourHand = document.getElementById('hour');
        const minuteHand = document.getElementById('minute');
        const secondHand = document.getElementById('second');
        const digitalClock = document.getElementById('digital');

        // –•—Ä–∞–Ω–∏–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—ë—Ä–≥–∞–Ω—å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —á–µ—Ä–µ–∑ 12
        let prevSecondDeg = null;
        let prevMinuteDeg = null;
        let prevHourDeg = null;
        let secondOffset = 0;
        let minuteOffset = 0;
        let hourOffset = 0;

        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∑–≤—É–∫–∞ –∫—É—Ä–∞–Ω—Ç–æ–≤
        const chimesAudio = new Audio('clock.mp3');
        chimesAudio.preload = 'auto';
        let chimesDuration = 0;
        let chimesReady = false;
        let chimesStartSecond = 0; // –°–µ–∫—É–Ω–¥–∞, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        let chimesPlaying = false; // –§–ª–∞–≥, —á—Ç–æ –∫—É—Ä–∞–Ω—Ç—ã —É–∂–µ –∏–≥—Ä–∞—é—Ç –≤ —ç—Ç–æ–π –º–∏–Ω—É—Ç–µ

        chimesAudio.addEventListener('loadedmetadata', () => {
            chimesDuration = chimesAudio.duration;
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–µ–∫—É–Ω–¥—É —Å—Ç–∞—Ä—Ç–∞: –∑–≤—É–∫ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–æ–Ω—á–∏—Ç—å—Å—è –∫ 0-–π —Å–µ–∫—É–Ω–¥–µ —Å–ª–µ–¥—É—é—â–µ–π –º–∏–Ω—É—Ç—ã
            chimesStartSecond = Math.ceil(60 - chimesDuration);
            chimesReady = true;
            console.log(`–ö—É—Ä–∞–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã: ${chimesDuration.toFixed(1)}—Å, —Å—Ç–∞—Ä—Ç –Ω–∞ ${chimesStartSecond}-–π —Å–µ–∫—É–Ω–¥–µ`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∑–≤—É–∫ —É–∂–µ –¥–æ–ª–∂–µ–Ω –∏–≥—Ä–∞—Ç—å
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const milliseconds = now.getMilliseconds();
            
            // –ö—É—Ä–∞–Ω—Ç—ã –∏–≥—Ä–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ 12:00 –∏ 00:00
            const isBeforeNoon = hours === 11 && minutes === 59;
            const isBeforeMidnight = hours === 23 && minutes === 59;
            const shouldPlayChimes = isBeforeNoon || isBeforeMidnight;
            
            if (shouldPlayChimes && seconds >= chimesStartSecond) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º, —Å –∫–∞–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞—á–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                const secondsUntilMinuteEnd = 60 - seconds - (milliseconds / 1000);
                const startOffset = chimesDuration - secondsUntilMinuteEnd;
                
                if (startOffset >= 0 && startOffset < chimesDuration) {
                    chimesAudio.currentTime = startOffset;
                    chimesAudio.play().then(() => {
                        chimesPlaying = true;
                        console.log(`–ö—É—Ä–∞–Ω—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã —Å ${startOffset.toFixed(1)}—Å (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è)`);
                    }).catch(() => {
                        document.getElementById('audioHint').classList.add('visible');
                    });
                }
            }
        });

        chimesAudio.addEventListener('canplaythrough', () => {
            chimesReady = true;
        });

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        chimesAudio.load();

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∑–≤—É–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ (–±—Ä–∞—É–∑–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç autoplay)
        let audioUnlocked = false;
        const audioHint = document.getElementById('audioHint');
        
        function showAudioHint() {
            audioHint.classList.add('visible');
        }
        
        function hideAudioHint() {
            audioHint.classList.remove('visible');
        }
        
        function unlockAudio() {
            if (audioUnlocked) return;
            
            // –ü—Ä–æ–±—É–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∏ —Å—Ä–∞–∑—É –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            const unlockPromise = chimesAudio.play();
            if (unlockPromise) {
                unlockPromise.then(() => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–µ–π—á–∞—Å –ª–∏ –≤—Ä–µ–º—è –∫—É—Ä–∞–Ω—Ç–æ–≤ (–ø–µ—Ä–µ–¥ 12:00 –∏–ª–∏ 00:00)
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    const seconds = now.getSeconds();
                    
                    const isBeforeNoon = hours === 11 && minutes === 59;
                    const isBeforeMidnight = hours === 23 && minutes === 59;
                    const shouldPlayChimes = isBeforeNoon || isBeforeMidnight;
                    
                    if (!shouldPlayChimes || seconds < chimesStartSecond || !chimesReady) {
                        chimesAudio.pause();
                        chimesAudio.currentTime = 0;
                    } else {
                        // –ï—Å–ª–∏ –≤—Ä–µ–º—è –∫—É—Ä–∞–Ω—Ç–æ–≤ - –ø—É—Å—Ç—å –∏–≥—Ä–∞–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                        const milliseconds = now.getMilliseconds();
                        const secondsUntilMinuteEnd = 60 - seconds - (milliseconds / 1000);
                        const startOffset = chimesDuration - secondsUntilMinuteEnd;
                        if (startOffset >= 0 && startOffset < chimesDuration) {
                            chimesAudio.currentTime = startOffset;
                            chimesPlaying = true;
                        }
                    }
                    audioUnlocked = true;
                    hideAudioHint();
                }).catch(() => {
                    showAudioHint();
                });
            }
        }
        
        // –°–ª—É—à–∞–µ–º –ª—é–±—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
        ['click', 'touchstart', 'keydown'].forEach(event => {
            document.addEventListener(event, unlockAudio, { once: false, passive: true });
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(() => {
            if (!audioUnlocked) {
                chimesAudio.play().then(() => {
                    chimesAudio.pause();
                    chimesAudio.currentTime = 0;
                    audioUnlocked = true;
                }).catch(() => {
                    showAudioHint();
                });
            }
        }, 500);

        // ===== –ö–û–ù–§–ï–¢–¢–ò –ò –•–õ–û–ü–£–®–ö–ê =====
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        let confettiParticles = [];
        let confettiAnimating = false;

        function resizeConfettiCanvas() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }
        resizeConfettiCanvas();
        window.addEventListener('resize', resizeConfettiCanvas);

        // –¶–≤–µ—Ç–∞ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        const confettiColors = [
            '#ff6b6b', '#ffd93d', '#6bcb77', '#4d96ff', '#ff6bd6',
            '#c9b037', '#ad8a56', '#f0e68c', '#ffa500', '#ff4500',
            '#00ff7f', '#ff1493', '#00bfff', '#ff69b4', '#ffd700'
        ];

        class ConfettiParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 20;
                this.vy = Math.random() * -18 - 5;
                this.gravity = 0.4;
                this.drag = 0.99;
                this.rotation = Math.random() * 360;
                this.rotationSpeed = (Math.random() - 0.5) * 15;
                this.width = Math.random() * 10 + 5;
                this.height = Math.random() * 6 + 3;
                this.color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                this.opacity = 1;
                this.wobble = Math.random() * 10;
                this.wobbleSpeed = Math.random() * 0.1 + 0.05;
            }

            update() {
                this.vy += this.gravity;
                this.vx *= this.drag;
                this.vy *= this.drag;
                this.x += this.vx + Math.sin(this.wobble) * 2;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                this.wobble += this.wobbleSpeed;
                
                if (this.y > confettiCanvas.height + 50) {
                    this.opacity -= 0.02;
                }
            }

            draw() {
                confettiCtx.save();
                confettiCtx.translate(this.x, this.y);
                confettiCtx.rotate(this.rotation * Math.PI / 180);
                confettiCtx.globalAlpha = this.opacity;
                confettiCtx.fillStyle = this.color;
                confettiCtx.fillRect(-this.width / 2, -this.height / 2, this.width, this.height);
                confettiCtx.restore();
            }
        }

        function launchConfetti() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            // –°–æ–∑–¥–∞—ë–º 150 —á–∞—Å—Ç–∏—Ü
            for (let i = 0; i < 150; i++) {
                confettiParticles.push(new ConfettiParticle(centerX, centerY));
            }
            
            if (!confettiAnimating) {
                confettiAnimating = true;
                animateConfetti();
            }
        }

        function animateConfetti() {
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            
            confettiParticles = confettiParticles.filter(p => p.opacity > 0);
            
            confettiParticles.forEach(particle => {
                particle.update();
                particle.draw();
            });
            
            if (confettiParticles.length > 0) {
                requestAnimationFrame(animateConfetti);
            } else {
                confettiAnimating = false;
            }
        }

        function celebrate() {
            launchConfetti();
        }

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –º–∏–Ω—É—Ç—ã
        let lastCelebrateMinute = -1;

        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const milliseconds = now.getMilliseconds();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –ª–∏ 12:00 (–ø–æ–ª–¥–µ–Ω—å –∏–ª–∏ –ø–æ–ª–Ω–æ—á—å)
            // –ö—É—Ä–∞–Ω—Ç—ã –∏–≥—Ä–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ 12:00 –∏ 00:00
            const isBeforeNoon = hours === 11 && minutes === 59;
            const isBeforeMidnight = hours === 23 && minutes === 59;
            const shouldPlayChimes = isBeforeNoon || isBeforeMidnight;

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∫—É—Ä–∞–Ω—Ç—ã —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å —Ä–æ–≤–Ω–æ –∫ 12:00
            if (chimesReady && shouldPlayChimes && seconds >= chimesStartSecond && !chimesPlaying) {
                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                const secondsUntilMinuteEnd = 60 - seconds - (milliseconds / 1000);
                const startOffset = chimesDuration - secondsUntilMinuteEnd;
                
                if (startOffset >= 0 && startOffset < chimesDuration) {
                    chimesAudio.currentTime = startOffset;
                    chimesAudio.play().then(() => {
                        chimesPlaying = true;
                        hideAudioHint();
                    }).catch(() => {
                        showAudioHint();
                    });
                }
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∫–æ–≥–¥–∞ –Ω–µ –≤—Ä–µ–º—è –∫—É—Ä–∞–Ω—Ç–æ–≤
            if (!shouldPlayChimes && chimesPlaying) {
                chimesPlaying = false;
            }
            if (seconds < chimesStartSecond && chimesPlaying) {
                chimesPlaying = false;
            }

            // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ 12:00 –∏ 00:00
            const isTwelve = (hours === 12 || hours === 0) && minutes === 0;
            if (seconds === 0 && isTwelve && hours !== lastCelebrateMinute) {
                lastCelebrateMinute = hours;
                celebrate();
            }

            // –ë–∞–∑–æ–≤—ã–µ —É–≥–ª—ã
            let secondsDeg = (seconds + milliseconds / 1000) * 6;
            let minutesDeg = minutes * 6 + (seconds + milliseconds / 1000) * 0.1;
            let hoursDeg = (hours % 12) * 30 + minutes * 0.5 + seconds * (0.5 / 60);

            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 360¬∞ ‚Üí 0¬∞
            if (prevSecondDeg !== null && prevSecondDeg > 300 && secondsDeg < 60) {
                secondOffset += 360;
            }
            if (prevMinuteDeg !== null && prevMinuteDeg > 300 && minutesDeg < 60) {
                minuteOffset += 360;
            }
            if (prevHourDeg !== null && prevHourDeg > 300 && hoursDeg < 60) {
                hourOffset += 360;
            }

            prevSecondDeg = secondsDeg;
            prevMinuteDeg = minutesDeg;
            prevHourDeg = hoursDeg;

            secondHand.style.transform = `rotate(${secondsDeg + secondOffset}deg)`;
            minuteHand.style.transform = `rotate(${minutesDeg + minuteOffset}deg)`;
            hourHand.style.transform = `rotate(${hoursDeg + hourOffset}deg)`;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä–æ–≤—ã–µ —á–∞—Å—ã
            digitalClock.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
        }

        // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
        updateClock();

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        function tick() {
            updateClock();
            requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
        if ('serviceWorker' in navigator) {
            let refreshing = false;
            
            navigator.serviceWorker.register('sw.js')
                .then(registration => {
                    console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
                    setInterval(() => {
                        registration.update();
                    }, 60000);
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è service worker
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                                    console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...');
                                    if (!refreshing) {
                                        refreshing = true;
                                        window.location.reload();
                                    }
                                }
                            });
                        }
                    });
                })
                .catch(err => console.log('Service Worker –æ—à–∏–±–∫–∞:', err));
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç service worker
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –≤–µ—Ä—Å–∏–∏:', event.data.version);
                    if (!refreshing) {
                        refreshing = true;
                        window.location.reload();
                    }
                } else if (event.data && event.data.type === 'CONTENT_UPDATED') {
                    console.log('–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª:', event.data.url);
                    // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                    if (!refreshing && event.data.url.includes('index.html')) {
                        refreshing = true;
                        window.location.reload();
                    }
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ service worker —É–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.addEventListener('statechange', () => {
                    if (navigator.serviceWorker.controller.state === 'activated' && !refreshing) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
                        navigator.serviceWorker.getRegistration().then(registration => {
                            if (registration) {
                                registration.update();
                            }
                        });
                    }
                });
            }
        }
    </script>
</body>
</html>

